<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetTracker - Análises Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .metric-card {
            background: linear-gradient(145deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(99, 102, 241, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .metric-card:hover::before {
            left: 100%;
        }

        .metric-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.6);
        }

        .sidebar {
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.95));
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-item {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: linear-gradient(180deg, #6366f1, #8b5cf6);
            transition: height 0.3s ease;
        }

        .nav-item.active::before,
        .nav-item:hover::before {
            height: 100%;
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.2), transparent);
            border-right: 2px solid #6366f1;
        }

        .tab-button {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(55, 65, 81, 0.5);
            backdrop-filter: blur(10px);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .tab-button:hover:not(.active) {
            background: rgba(75, 85, 99, 0.7);
            transform: translateY(-2px);
        }

        .chart-container {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .floating-header {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.95));
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pulse-dot {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .loading-spinner {
            border: 3px solid rgba(99, 102, 241, 0.3);
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .gradient-text {
            background: linear-gradient(135deg, #6366f1, #8b5cf6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            backdrop-filter: blur(10px);
        }

        .status-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-excellent {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .status-good {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .status-poor {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .filter-section {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.8));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .insight-card {
            background: linear-gradient(145deg, rgba(6, 182, 212, 0.1), rgba(99, 102, 241, 0.1));
            border-left: 4px solid #06b6d4;
            transition: all 0.3s ease;
        }

        .insight-card:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.2);
        }

        .profit-positive { color: #10b981; }
        .profit-negative { color: #ef4444; }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-data {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #6b7280;
            font-size: 1.1rem;
        }

        .ts-control, .ts-dropdown { 
            background-color: #374151 !important; 
            color: #fff !important; 
            border-radius: 0.5rem !important; 
            border: 1px solid #4b5563 !important;
            width: 100% !important;
        }

        .ts-dropdown .option:hover { 
            background: rgba(99, 102, 241, 0.3) !important; 
        }

        .ts-wrapper { 
            width: 100% !important; 
            position: relative; 
            z-index: 10; 
        }
        .ts-dropdown { 
            z-index: 1000 !important; 
            position: absolute !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3) !important;
        }
        .filter-section {
            position: relative;
            z-index: 100;
        }
        .tab-buttons {
            position: relative;
            z-index: 50;
        }

        /* Estilos para tabelas */
        .data-table {
            overflow-x: auto;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: rgba(15, 23, 42, 0.8);
            color: #9ca3af;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #d1d5db;
        }
        
        .data-table tbody tr:hover {
            background: rgba(99, 102, 241, 0.1);
        }
    </style>
</head>
<body class="bg-slate-900 text-white">
    <!-- Sidebar -->
    <div class="fixed left-0 top-0 h-full w-72 sidebar z-40">
        <div class="p-8">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                    <i data-lucide="trending-up" class="w-7 h-7 text-white"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold gradient-text">BetTracker</h1>
                    <p class="text-sm text-slate-400 font-medium">Analytics Pro</p>
                </div>
            </div>
        </div>

        <nav class="px-6 pb-6 space-y-2">
            <a href="teste.html" class="nav-item flex items-center space-x-4 px-6 py-4 rounded-2xl text-slate-300 hover:text-white transition-all">
                <i data-lucide="home" class="w-5 h-5"></i>
                <span class="font-medium">Início</span>
            </a>
            <a href="Apostas.html" class="nav-item flex items-center space-x-4 px-6 py-4 rounded-2xl text-slate-300 hover:text-white transition-all">
                <i data-lucide="target" class="w-5 h-5"></i>
                <span class="font-medium">Apostas</span>
            </a>
            <a href="resultados.html" class="nav-item flex items-center space-x-3 px-6 py-4 rounded-2xl text-slate-300 hover:text-white transition-all">
                    <i data-lucide="check-circle" class="w-5 h-5"></i>
                    <span class="font-medium">Resultados</span>
                </a>
                <a href="analises.html" class="nav-item flex items-center space-x-3 px-6 py-4 rounded-2xl text-slate-300 hover:text-white transition-all">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                    <span class="font-medium">Análises</span>
                </a>
                <a href="ia_insights.html" class="nav-item flex items-center space-x-3 px-6 py-4 rounded-2xl text-slate-300 hover:text-white transition-all">
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                    <span class="font-medium">IA Insights</span>
                </a>
            <a href="banca.html" class="nav-item flex items-center space-x-4 px-6 py-4 rounded-2xl text-slate-300 hover:text-white transition-all">
                <i data-lucide="wallet" class="w-5 h-5"></i>
                <span class="font-medium">Gestão de Banca</span>
            </a>
            <a href="#" class="nav-item flex items-center space-x-4 px-6 py-4 rounded-2xl text-slate-300 hover:text-white transition-all">
                <i data-lucide="settings" class="w-5 h-5"></i>
                <span class="font-medium">Configurações</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="ml-72 min-h-screen">
        <!-- Header -->
        <header class="floating-header sticky top-0 z-30 px-8 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-4xl font-bold gradient-text mb-2">Análises Avançadas</h2>
                    <p class="text-slate-400 text-lg">Dashboard inteligente com insights personalizados para suas apostas</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="loading-indicator" class="loading-spinner hidden"></div>
                    <div class="pulse-dot w-3 h-3 bg-green-400 rounded-full"></div>
                    <button id="refresh-data" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 flex items-center space-x-3 shadow-lg hover:shadow-xl">
                        <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                        <span class="font-medium">Atualizar</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="p-8 space-y-8">
            <!-- Navegação por Abas -->
            <div class="flex flex-wrap gap-3 tab-buttons">
                <button class="tab-button active px-8 py-4 rounded-2xl font-semibold transition-all duration-300" data-tab="dashboard">
                    <i data-lucide="home" class="w-5 h-5 mr-3 inline"></i>
                    Dashboard
                </button>
                <button class="tab-button px-8 py-4 rounded-2xl font-semibold transition-all duration-300" data-tab="performance">
                    <i data-lucide="zap" class="w-5 h-5 mr-3 inline"></i>
                    Performance
                </button>
                <button class="tab-button px-8 py-4 rounded-2xl font-semibold transition-all duration-300" data-tab="casas">
                    <i data-lucide="building" class="w-5 h-5 mr-3 inline"></i>
                    Casas de Apostas
                </button>
                <button class="tab-button px-8 py-4 rounded-2xl font-semibold transition-all duration-300" data-tab="categorias">
                    <i data-lucide="folder" class="w-5 h-5 mr-3 inline"></i>
                    Categorias
                </button>
                <button class="tab-button px-8 py-4 rounded-2xl font-semibold transition-all duration-300" data-tab="risk">
                    <i data-lucide="shield" class="w-5 h-5 mr-3 inline"></i>
                    Análise de Risco
                </button>
            </div>

            <!-- Filtros Inteligentes -->
            <div class="filter-section rounded-3xl p-8">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <div class="metric-icon p-2 rounded-xl mr-3">
                        <i data-lucide="filter" class="w-5 h-5"></i>
                    </div>
                    Filtros Inteligentes
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-300">Data Inicial</label>
                        <input type="date" id="filter-date-start" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-300">Data Final</label>
                        <input type="date" id="filter-date-end" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-300">Casa de Apostas</label>
                        <select id="filter-house" class="w-full" multiple></select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-300">Tipo de Aposta</label>
                        <select id="filter-type" class="w-full" multiple></select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-300">Categoria/Torneio</label>
                        <select id="filter-tournament" class="w-full" multiple></select>
                    </div>
                    <div class="flex flex-col justify-end">
                        <button id="btn-clear-filters" class="px-6 py-3 bg-slate-700/50 hover:bg-slate-600/50 rounded-xl text-slate-300 hover:text-white transition-all duration-300">
                            Limpar Filtros
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Principal -->
            <div id="tab-dashboard" class="tab-content active space-y-8">
                <!-- Métricas Principais -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-emerald-400">
                                <i data-lucide="dollar-sign" class="w-8 h-8"></i>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Total Investido</p>
                                <div class="status-indicator status-excellent mt-1" id="metric-total-variation">-</div>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="metric-total-apostado">R$ 0,00</p>
                        <p class="text-slate-400 font-medium">Total Apostado</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-blue-400">
                                <i data-lucide="trending-up" class="w-8 h-8"></i>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Meta: 5%+</p>
                                <div class="status-indicator status-good mt-1" id="metric-roi-status">-</div>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="metric-roi">0%</p>
                        <p class="text-slate-400 font-medium">ROI</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-yellow-400">
                                <i data-lucide="badge-dollar-sign" class="w-8 h-8"></i>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Maior Ganho</p>
                                <p class="text-sm font-bold text-emerald-400 mt-1" id="metric-maior-ganho">R$ 0,00</p>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="metric-lucro">R$ 0,00</p>
                        <p class="text-slate-400 font-medium">Lucro/Prejuízo</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-purple-400">
                                <i data-lucide="activity" class="w-8 h-8"></i>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Meta: 60%+</p>
                                <div class="status-indicator status-excellent mt-1" id="metric-taxa-status">-</div>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="metric-taxa-acerto">0%</p>
                        <p class="text-slate-400 font-medium">Taxa de Acerto</p>
                    </div>
                </div>

                <!-- Gráficos Principais -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="chart-container rounded-3xl p-8">
                        <h3 class="text-2xl font-bold mb-6 flex items-center">
                            <div class="metric-icon p-2 rounded-xl mr-3">
                                <i data-lucide="line-chart" class="w-5 h-5"></i>
                            </div>
                            Evolução do Lucro
                        </h3>
                        <div class="h-80 flex items-center justify-center">
                            <canvas id="chart-evolucao-lucro" width="400" height="300"></canvas>
                        </div>
                    </div>
                    <div class="chart-container rounded-3xl p-8">
                        <h3 class="text-2xl font-bold mb-6 flex items-center">
                            <div class="metric-icon p-2 rounded-xl mr-3">
                                <i data-lucide="pie-chart" class="w-5 h-5"></i>
                            </div>
                            Distribuição de Resultados
                        </h3>
                        <div class="h-80 flex items-center justify-center">
                            <canvas id="chart-distribuicao-resultados" width="300" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Estatísticas Rápidas -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="glass-card rounded-3xl p-8">
                        <h4 class="text-xl font-bold mb-6 flex items-center">
                            <div class="metric-icon p-2 rounded-xl mr-3">
                                <i data-lucide="calendar" class="w-5 h-5"></i>
                            </div>
                            Atividade
                        </h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Total de Apostas:</span>
                                <span class="text-xl font-bold" id="stat-total-apostas">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Apostas/Dia (média):</span>
                                <span class="text-xl font-bold" id="stat-apostas-dia">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Dias ativos:</span>
                                <span class="text-xl font-bold" id="stat-dias-ativos">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-3xl p-8">
                        <h4 class="text-xl font-bold mb-6 flex items-center">
                            <div class="metric-icon p-2 rounded-xl mr-3">
                                <i data-lucide="target" class="w-5 h-5"></i>
                            </div>
                            Odds
                        </h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Odd Média:</span>
                                <span class="text-xl font-bold" id="stat-odd-media">0.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Odd Mais Alta:</span>
                                <span class="text-xl font-bold text-emerald-400" id="stat-odd-alta">0.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Odd Mais Baixa:</span>
                                <span class="text-xl font-bold text-red-400" id="stat-odd-baixa">0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-3xl p-8">
                        <h4 class="text-xl font-bold mb-6 flex items-center">
                            <div class="metric-icon p-2 rounded-xl mr-3">
                                <i data-lucide="trending-up" class="w-5 h-5"></i>
                            </div>
                            Sequências
                        </h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Maior Seq. Vitórias:</span>
                                <span class="text-xl font-bold text-emerald-400" id="stat-seq-vitorias">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Maior Seq. Derrotas:</span>
                                <span class="text-xl font-bold text-red-400" id="stat-seq-derrotas">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Sequência Atual:</span>
                                <span class="text-xl font-bold" id="stat-seq-atual">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights -->
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-2xl font-bold mb-6 flex items-center">
                        <div class="metric-icon p-2 rounded-xl mr-3">
                            <i data-lucide="brain" class="w-5 h-5"></i>
                        </div>
                        Insights e Recomendações IA
                    </h3>
                    <div id="insights-container" class="space-y-4">
                        <div class="insight-card p-6 rounded-2xl">
                            <div class="flex items-start space-x-4">
                                <div class="metric-icon p-2 rounded-xl">
                                    <i data-lucide="lightbulb" class="w-5 h-5 text-cyan-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-white mb-2">Aguardando dados</h4>
                                    <p class="text-slate-300">Adicione apostas para gerar insights personalizados sobre sua performance.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Performance -->
            <div id="tab-performance" class="tab-content space-y-8">
                <!-- Métricas de Performance -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-blue-400">
                                <i data-lucide="percent" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="perf-yield">0%</p>
                        <p class="text-slate-400 font-medium">Yield</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-green-400">
                                <i data-lucide="trending-up" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="perf-roi-consistencia">0%</p>
                        <p class="text-slate-400 font-medium">Consistência ROI</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-purple-400">
                                <i data-lucide="target" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="perf-strike-rate">0%</p>
                        <p class="text-slate-400 font-medium">Strike Rate</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-yellow-400">
                                <i data-lucide="calendar" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="perf-apostas-mes">0</p>
                        <p class="text-slate-400 font-medium">Apostas/Mês</p>
                    </div>
                </div>

                <!-- Análise Avançada -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="glass-card rounded-3xl p-8">
                        <h4 class="text-xl font-bold mb-6">Análise Temporal</h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Melhor Mês:</span>
                                <span class="text-xl font-bold text-green-400" id="perf-melhor-mes">-</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Pior Mês:</span>
                                <span class="text-xl font-bold text-red-400" id="perf-pior-mes">-</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Mês Atual:</span>
                                <span class="text-xl font-bold" id="perf-mes-atual">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-3xl p-8">
                        <h4 class="text-xl font-bold mb-6">Otimização</h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Odd Ótima:</span>
                                <span class="text-xl font-bold text-blue-400" id="perf-odd-otima">2.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Volume Ideal:</span>
                                <span class="text-xl font-bold text-blue-400" id="perf-volume-ideal">R$ 0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">ROI Projetado:</span>
                                <span class="text-xl font-bold text-green-400" id="perf-roi-projetado">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-3xl p-8">
                        <h4 class="text-xl font-bold mb-6">Eficiência</h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Precisão:</span>
                                <span class="text-xl font-bold" id="perf-precisao">0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">Recall:</span>
                                <span class="text-xl font-bold" id="perf-recall">0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400 font-medium">F1-Score:</span>
                                <span class="text-xl font-bold" id="perf-f1-score">0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Casas de Apostas -->
            <div id="tab-casas" class="tab-content space-y-8">
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-2xl font-bold mb-6 flex items-center">
                        <div class="metric-icon p-2 rounded-xl mr-3">
                            <i data-lucide="building" class="w-5 h-5"></i>
                        </div>
                        Ranking de Casas de Apostas
                    </h3>
                    
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Casa de Apostas</th>
                                    <th>Total Apostas</th>
                                    <th>Taxa Acerto</th>
                                    <th>ROI</th>
                                    <th>Lucro Total</th>
                                    <th>Avaliação</th>
                                </tr>
                            </thead>
                            <tbody id="table-ranking-casas">
                                <tr>
                                    <td colspan="6" class="text-center text-slate-500 py-8">Carregando dados...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="chart-container rounded-3xl p-8">
                    <h3 class="text-2xl font-bold mb-6">Volume de Apostas por Casa</h3>
                    <div id="chart-casas-volume-css" class="css-chart"></div>
                </div>
            </div>

            <!-- Aba Categorias -->
            <div id="tab-categorias" class="tab-content space-y-8">
                <div class="glass-card rounded-3xl p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold flex items-center">
                            <div class="metric-icon p-2 rounded-xl mr-3">
                                <i data-lucide="folder" class="w-5 h-5"></i>
                            </div>
                            Análise por Categorias
                        </h3>
                        <div class="text-right">
                            <p class="text-sm text-slate-400">Total de Categorias</p>
                            <p class="text-2xl font-bold" id="total-categorias">0</p>
                        </div>
                    </div>
                    
                    <div id="categorias-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="glass-card rounded-3xl p-6">
                            <h4 class="font-semibold mb-4 text-gray-200">Carregando...</h4>
                            <p class="text-sm text-slate-500">Dados sendo processados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Análise de Risco -->
            <div id="tab-risk" class="tab-content space-y-8">
                <!-- Métricas de Risco -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-red-400">
                                <i data-lucide="trending-down" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2 text-red-400" id="risk-drawdown">0%</p>
                        <p class="text-slate-400 font-medium">Max Drawdown</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-yellow-400">
                                <i data-lucide="activity" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="risk-volatility">0%</p>
                        <p class="text-slate-400 font-medium">Volatilidade</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-purple-400">
                                <i data-lucide="shield" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2" id="risk-score">0</p>
                        <p class="text-slate-400 font-medium">Score de Risco</p>
                    </div>

                    <div class="metric-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div class="metric-icon p-4 rounded-2xl text-green-400">
                                <i data-lucide="calculator" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-4xl font-bold mb-2 text-green-400" id="risk-kelly">0%</p>
                        <p class="text-slate-400 font-medium">Kelly %</p>
                    </div>
                </div>

                <!-- Recomendações de Risco -->
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-2xl font-bold mb-6 flex items-center">
                        <div class="metric-icon p-2 rounded-xl mr-3">
                            <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                        </div>
                        Recomendações de Gestão de Risco
                    </h3>
                    <div id="risk-recommendations" class="space-y-4">
                        <div class="insight-card p-6 rounded-2xl">
                            <div class="flex items-center space-x-4">
                                <div class="metric-icon p-2 rounded-xl">
                                    <i data-lucide="info" class="w-5 h-5 text-blue-400"></i>
                                </div>
                                <span class="font-semibold">Carregando análise de risco...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Configuração do Supabase
        const SUPABASE_CONFIG = {
            url: 'https://cjlvcjfuntfbdrrkigwh.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNqbHZjamZ1bnRmYmRycmtpZ3doIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDAyMzYyMDIsImV4cCI6MjA1NTgxMjIwMn0.FBSsXa2vVmrv78_XeLWZcpMKMUIeRe0mS9hBO7Cn45Y'
        };
        
        // Variáveis globais
        let supabase;
        let apostas = [];
        let apostasFiltradas = [];
        let charts = {};
        let tomSelects = {};

        // Funções utilitárias
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function formatarPercentual(valor) {
            return `${valor.toFixed(1)}%`;
        }

        function calcularROI(lucro, totalApostado) {
            if (totalApostado === 0) return 0;
            return (lucro / totalApostado) * 100;
        }

        function calcularTaxaAcerto(ganhas, total) {
            if (total === 0) return 0;
            return (ganhas / total) * 100;
        }

        function showLoading() {
            const loader = document.getElementById('loading-indicator');
            if (loader) loader.classList.remove('hidden');
        }

        function hideLoading() {
            const loader = document.getElementById('loading-indicator');
            if (loader) loader.classList.add('hidden');
        }

        // Função auxiliar para verificar se elemento existe antes de atualizar
        function updateElementSafely(id, value, isHtml = false) {
            const element = document.getElementById(id);
            if (element) {
                if (isHtml) {
                    element.innerHTML = value;
                } else {
                    element.textContent = value;
                }
                return true;
            }
            return false;
        }

        // Sistema de abas
        function configurarAbas() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    const targetContent = document.getElementById(`tab-${targetTab}`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                    
                    // Carregar conteúdo específico da aba
                    setTimeout(() => {
                        carregarConteudoAba(targetTab);
                    }, 100);
                });
            });
        }

        function carregarConteudoAba(aba) {
            try {
                console.log(`Carregando aba: ${aba}`);
                
                switch (aba) {
                    case 'dashboard':
                        atualizarAnalises();
                        break;
                    case 'performance':
                        atualizarPerformance();
                        break;
                    case 'casas':
                        atualizarCasasDeApostas();
                        break;
                    case 'categorias':
                        atualizarCategorias();
                        break;
                    case 'risk':
                        atualizarAnaliseRisco();
                        break;
                }
                
                // Recriar ícones Lucide
                if (window.lucide) {
                    lucide.createIcons();
                }
            } catch (error) {
                console.error(`Erro ao carregar aba ${aba}:`, error);
            }
        }

        // Funções para aba Performance
        function atualizarPerformance() {
            try {
                const apostasValidas = apostasFiltradas.filter(a => a.resultado === 'Ganhou' || a.resultado === 'Perdeu');
                
                if (apostasValidas.length === 0) {
                    updateElementSafely('perf-yield', '0%');
                    updateElementSafely('perf-roi-consistencia', '0%');
                    updateElementSafely('perf-strike-rate', '0%');
                    updateElementSafely('perf-apostas-mes', '0');
                    return;
                }
                
                const totalApostado = apostasValidas.reduce((sum, a) => sum + parseFloat(a.valor_apostado), 0);
                const lucro = calcularLucroTotal();
                const yield_ = totalApostado > 0 ? (lucro / totalApostado) * 100 : 0;
                
                // Consistência ROI (simulada)
                const consistencia = Math.abs(yield_) > 0 ? Math.min(100, Math.abs(yield_) * 5) : 0;
                
                // Strike Rate (% de acertos em odds altas > 2.5)
                const apostasAltas = apostasValidas.filter(a => parseFloat(a.odd_final || a.odd_inicial) > 2.5);
                const acertosAltos = apostasAltas.filter(a => a.resultado === 'Ganhou').length;
                const strikeRate = apostasAltas.length > 0 ? (acertosAltos / apostasAltas.length) * 100 : 0;
                
                // Apostas por mês
                const meses = new Set(apostasValidas.map(a => a.data.substring(0, 7))).size || 1;
                const apostasPorMes = apostasValidas.length / meses;
                
                // Atualizar elementos
                updateElementSafely('perf-yield', formatarPercentual(yield_));
                updateElementSafely('perf-roi-consistencia', formatarPercentual(consistencia));
                updateElementSafely('perf-strike-rate', formatarPercentual(strikeRate));
                updateElementSafely('perf-apostas-mes', Math.round(apostasPorMes));
                updateElementSafely('perf-melhor-mes', yield_ > 0 ? new Date().toLocaleDateString('pt-BR', { month: 'short' }) : '-');
                updateElementSafely('perf-odd-otima', calcularOddOtima().toFixed(2));
                
                const volumeIdeal = totalApostado / apostasValidas.length;
                updateElementSafely('perf-volume-ideal', formatarMoeda(volumeIdeal));
                
                console.log('Performance atualizada');
            } catch (error) {
                console.error('Erro ao atualizar performance:', error);
            }
        }

        function calcularOddOtima() {
            const apostasValidas = apostasFiltradas.filter(a => a.resultado === 'Ganhou' || a.resultado === 'Perdeu');
            if (apostasValidas.length === 0) return 2.0;
            
            // Calcular ROI por faixa de odd
            const faixas = {
                baixa: { min: 1.0, max: 2.0, apostas: [], lucro: 0, investido: 0 },
                media: { min: 2.0, max: 3.5, apostas: [], lucro: 0, investido: 0 },
                alta: { min: 3.5, max: 10.0, apostas: [], lucro: 0, investido: 0 }
            };
            
            apostasValidas.forEach(aposta => {
                const odd = parseFloat(aposta.odd_final || aposta.odd_inicial);
                const valorApostado = parseFloat(aposta.valor_apostado);
                const valorFinal = parseFloat(aposta.valor_final);
                
                if (odd >= faixas.baixa.min && odd < faixas.baixa.max) {
                    faixas.baixa.apostas.push(aposta);
                    faixas.baixa.investido += valorApostado;
                    faixas.baixa.lucro += valorFinal;
                } else if (odd >= faixas.media.min && odd < faixas.media.max) {
                    faixas.media.apostas.push(aposta);
                    faixas.media.investido += valorApostado;
                    faixas.media.lucro += valorFinal;
                } else if (odd >= faixas.alta.min && odd < faixas.alta.max) {
                    faixas.alta.apostas.push(aposta);
                    faixas.alta.investido += valorApostado;
                    faixas.alta.lucro += valorFinal;
                }
            });
            
            // Encontrar faixa com melhor ROI
            let melhorFaixa = 'media';
            let melhorROI = -100;
            
            Object.keys(faixas).forEach(faixa => {
                const roi = faixas[faixa].investido > 0 ? (faixas[faixa].lucro / faixas[faixa].investido) * 100 : -100;
                if (roi > melhorROI) {
                    melhorROI = roi;
                    melhorFaixa = faixa;
                }
            });
            
            // Retornar ponto médio da melhor faixa
            const faixaEscolhida = faixas[melhorFaixa];
            return (faixaEscolhida.min + faixaEscolhida.max) / 2;
        }

        // Funções para aba Casas de Apostas
        function atualizarCasasDeApostas() {
            try {
                const apostasValidas = apostasFiltradas.filter(a => a.resultado === 'Ganhou' || a.resultado === 'Perdeu');
                const dadosPorCasa = {};
                
                apostasValidas.forEach(aposta => {
                    const casa = aposta.casa_de_apostas;
                    if (!dadosPorCasa[casa]) {
                        dadosPorCasa[casa] = {
                            total: 0,
                            ganhas: 0,
                            investido: 0,
                            lucro: 0
                        };
                    }
                    
                    dadosPorCasa[casa].total++;
                    dadosPorCasa[casa].investido += parseFloat(aposta.valor_apostado);
                    dadosPorCasa[casa].lucro += parseFloat(aposta.valor_final);
                    
                    if (aposta.resultado === 'Ganhou') {
                        dadosPorCasa[casa].ganhas++;
                    }
                });
                
                // Criar tabela de ranking
                const tbody = document.getElementById('table-ranking-casas');
                if (tbody && Object.keys(dadosPorCasa).length > 0) {
                    const casasOrdenadas = Object.entries(dadosPorCasa)
                        .sort(([,a], [,b]) => {
                            const roiA = a.investido > 0 ? (a.lucro / a.investido) * 100 : -100;
                            const roiB = b.investido > 0 ? (b.lucro / b.investido) * 100 : -100;
                            return roiB - roiA;
                        });
                    
                    tbody.innerHTML = casasOrdenadas.map(([casa, dados]) => {
                        const taxaAcerto = dados.total > 0 ? (dados.ganhas / dados.total) * 100 : 0;
                        const roi = dados.investido > 0 ? (dados.lucro / dados.investido) * 100 : 0;
                        const roiClass = roi >= 0 ? 'profit-positive' : 'profit-negative';
                        const lucroClass = dados.lucro >= 0 ? 'profit-positive' : 'profit-negative';
                        
                        let avaliacao = '⭐';
                        if (roi >= 10 && taxaAcerto >= 60) avaliacao = '⭐⭐⭐⭐⭐';
                        else if (roi >= 5 && taxaAcerto >= 50) avaliacao = '⭐⭐⭐⭐';
                        else if (roi >= 0 && taxaAcerto >= 45) avaliacao = '⭐⭐⭐';
                        else if (roi >= 0) avaliacao = '⭐⭐';
                        
                        return `
                            <tr class="hover:bg-slate-700/50 transition-colors">
                                <td class="px-6 py-4 font-semibold">${casa}</td>
                                <td class="px-6 py-4">${dados.total}</td>
                                <td class="px-6 py-4">${formatarPercentual(taxaAcerto)}</td>
                                <td class="px-6 py-4 ${roiClass} font-semibold">${formatarPercentual(roi)}</td>
                                <td class="px-6 py-4 ${lucroClass} font-semibold">${formatarMoeda(dados.lucro)}</td>
                                <td class="px-6 py-4 text-lg">${avaliacao}</td>
                            </tr>
                        `;
                    }).join('');
                } else if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center text-slate-500 py-8">Nenhum dado disponível</td></tr>';
                }
                
                // Criar gráfico de volume
                criarGraficoVolumeCasas(dadosPorCasa);
                
                console.log('Casas de apostas atualizadas');
            } catch (error) {
                console.error('Erro ao atualizar casas:', error);
            }
        }

        function criarGraficoVolumeCasas(dados) {
            const container = document.getElementById('chart-casas-volume-css');
            if (!container || Object.keys(dados).length === 0) {
                if (container) {
                    container.innerHTML = '<div class="text-center text-slate-500 py-8">Nenhum dado disponível</div>';
                }
                return;
            }
            
            const maxVolume = Math.max(...Object.values(dados).map(d => d.investido));
            const cores = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b'];
            
            container.innerHTML = Object.entries(dados).map(([casa, dadosCasa], index) => {
                const altura = maxVolume > 0 ? (dadosCasa.investido / maxVolume) * 100 : 0;
                const cor = cores[index % cores.length];
                
                return `
                    <div class="flex flex-col items-center">
                        <div style="width: 40px; height: ${altura}%; background: ${cor}; border-radius: 4px; margin-bottom: 8px; transition: all 0.3s ease;"></div>
                        <div class="text-xs text-center">
                            <div class="font-semibold">${casa}</div>
                            <div class="text-slate-400">${formatarMoeda(dadosCasa.investido)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Funções para aba Categorias
        function atualizarCategorias() {
            try {
                const apostasValidas = apostasFiltradas.filter(a => a.resultado === 'Ganhou' || a.resultado === 'Perdeu');
                const dadosPorCategoria = {};
                
                apostasValidas.forEach(aposta => {
                    const categoria = aposta.categoria || 'Sem Categoria';
                    if (!dadosPorCategoria[categoria]) {
                        dadosPorCategoria[categoria] = {
                            total: 0,
                            ganhas: 0,
                            investido: 0,
                            lucro: 0
                        };
                    }
                    
                    dadosPorCategoria[categoria].total++;
                    dadosPorCategoria[categoria].investido += parseFloat(aposta.valor_apostado);
                    dadosPorCategoria[categoria].lucro += parseFloat(aposta.valor_final);
                    
                    if (aposta.resultado === 'Ganhou') {
                        dadosPorCategoria[categoria].ganhas++;
                    }
                });
                
                // Atualizar contador total
                updateElementSafely('total-categorias', Object.keys(dadosPorCategoria).length);
                
                // Criar cards de categorias
                const container = document.getElementById('categorias-cards');
                if (container) {
                    if (Object.keys(dadosPorCategoria).length === 0) {
                        container.innerHTML = `
                            <div class="glass-card rounded-3xl p-6 col-span-full">
                                <h4 class="font-semibold mb-4 text-gray-200">Nenhuma categoria encontrada</h4>
                                <p class="text-sm text-slate-500">Adicione apostas com categorias para ver a análise</p>
                            </div>
                        `;
                    } else {
                        const categoriasOrdenadas = Object.entries(dadosPorCategoria)
                            .sort(([,a], [,b]) => {
                                const roiA = a.investido > 0 ? (a.lucro / a.investido) * 100 : -100;
                                const roiB = b.investido > 0 ? (b.lucro / b.investido) * 100 : -100;
                                return roiB - roiA;
                            });
                        
                        container.innerHTML = categoriasOrdenadas.map(([categoria, dados]) => {
                            const taxaAcerto = dados.total > 0 ? (dados.ganhas / dados.total) * 100 : 0;
                            const roi = dados.investido > 0 ? (dados.lucro / dados.investido) * 100 : 0;
                            const roiClass = roi >= 0 ? 'text-green-400' : 'text-red-400';
                            const roiIcon = roi >= 0 ? '↗' : '↘';
                            
                            return `
                                <div class="glass-card rounded-3xl p-6">
                                    <h4 class="font-semibold mb-4 text-gray-200">${categoria}</h4>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-xs text-gray-400">Apostas</p>
                                            <p class="text-lg font-semibold text-white">${dados.total}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-400">Taxa Acerto</p>
                                            <p class="text-lg font-semibold text-white">${formatarPercentual(taxaAcerto)}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-400">ROI</p>
                                            <p class="text-lg font-semibold ${roiClass}">${roiIcon} ${formatarPercentual(roi)}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-400">Lucro</p>
                                            <p class="text-lg font-semibold ${dados.lucro >= 0 ? 'text-green-400' : 'text-red-400'}">
                                                ${formatarMoeda(dados.lucro)}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                }
                
                console.log('Categorias atualizadas');
            } catch (error) {
                console.error('Erro ao atualizar categorias:', error);
            }
        }

        // Funções para aba Análise de Risco
        function atualizarAnaliseRisco() {
            try {
                const apostasValidas = apostasFiltradas.filter(a => a.resultado === 'Ganhou' || a.resultado === 'Perdeu');
                
                if (apostasValidas.length === 0) {
                    updateElementSafely('risk-drawdown', '0%');
                    updateElementSafely('risk-volatility', '0%');
                    updateElementSafely('risk-score', '0');
                    updateElementSafely('risk-kelly', '0%');
                    return;
                }
                
                const { drawdown, volatilidade, scoreRisco, kelly } = calcularMetricasRisco(apostasValidas);
                
                updateElementSafely('risk-drawdown', formatarPercentual(drawdown));
                updateElementSafely('risk-volatility', formatarPercentual(volatilidade));
                updateElementSafely('risk-score', Math.round(scoreRisco));
                updateElementSafely('risk-kelly', formatarPercentual(kelly));
                
                gerarRecomendacoesRisco(scoreRisco, drawdown);
                
                console.log('Análise de risco atualizada');
            } catch (error) {
                console.error('Erro ao atualizar análise de risco:', error);
            }
        }

        function calcularMetricasRisco(apostasValidas) {
            let saldo = 0;
            let picoSaldo = 0;
            let maxDrawdown = 0;
            const retornos = [];
            
            apostasValidas.forEach(aposta => {
                saldo += parseFloat(aposta.valor_final);
                
                if (saldo > picoSaldo) picoSaldo = saldo;
                if (picoSaldo > 0) {
                    const drawdown = ((picoSaldo - saldo) / picoSaldo) * 100;
                    maxDrawdown = Math.max(maxDrawdown, drawdown);
                }
                
                const valorApostado = parseFloat(aposta.valor_apostado);
                if (valorApostado > 0) {
                    retornos.push(parseFloat(aposta.valor_final) / valorApostado);
                }
            });
            
            // Volatilidade (desvio padrão dos retornos)
            const mediaRetornos = retornos.reduce((a, b) => a + b, 0) / retornos.length || 0;
            const variancia = retornos.reduce((acc, ret) => acc + Math.pow(ret - mediaRetornos, 2), 0) / retornos.length || 0;
            const volatilidade = Math.sqrt(variancia) * 100;
            
            // Score de risco (0-100)
            const scoreDrawdown = Math.min(maxDrawdown * 2, 50);
            const scoreVolatilidade = Math.min(volatilidade * 5, 30);
            const ganhas = apostasValidas.filter(a => a.resultado === 'Ganhou').length;
            const taxaAcerto = (ganhas / apostasValidas.length) * 100;
            const scoreTaxaAcerto = Math.max(0, 20 - (taxaAcerto / 3));
            const scoreRisco = scoreDrawdown + scoreVolatilidade + scoreTaxaAcerto;
            
            // Kelly Criterion simplificado
            const p = ganhas / apostasValidas.length; // Probabilidade de ganho
            const q = 1 - p; // Probabilidade de perda
            const b = 2.5; // Odd média aproximada
            const kelly = Math.max(0, ((b * p - q) / b) * 100);
            
            return {
                drawdown: maxDrawdown,
                volatilidade,
                scoreRisco,
                kelly
            };
        }

        function gerarRecomendacoesRisco(scoreRisco, drawdown) {
            const container = document.getElementById('risk-recommendations');
            if (!container) return;
            
            const recomendacoes = [];
            
            if (scoreRisco > 70) {
                recomendacoes.push({
                    tipo: 'danger',
                    icone: 'alert-triangle',
                    texto: 'Risco ALTO: Considere reduzir significativamente o valor das apostas.'
                });
            } else if (scoreRisco > 40) {
                recomendacoes.push({
                    tipo: 'warning',
                    icone: 'alert-circle',
                    texto: 'Risco MODERADO: Mantenha controle rigoroso do bankroll.'
                });
            } else {
                recomendacoes.push({
                    tipo: 'success',
                    icone: 'check-circle',
                    texto: 'Risco BAIXO: Gestão de risco adequada.'
                });
            }
            
            if (drawdown > 25) {
                recomendacoes.push({
                    tipo: 'warning',
                    icone: 'trending-down',
                    texto: 'Drawdown elevado: Implemente stop-loss mais rigoroso.'
                });
            }
            
            if (apostasFiltradas.length > 0) {
                const totalApostado = apostasFiltradas.reduce((sum, a) => sum + parseFloat(a.valor_apostado), 0);
                const mediaAposta = totalApostado / apostasFiltradas.length;
                
                recomendacoes.push({
                    tipo: 'info',
                    icone: 'info',
                    texto: `Valor médio por aposta: ${formatarMoeda(mediaAposta)}. Considere manter consistência.`
                });
            }
            
            container.innerHTML = recomendacoes.map(rec => `
                <div class="insight-card p-6 rounded-2xl ${
                    rec.tipo === 'danger' ? 'border-red-500/50 bg-red-500/10' : 
                    rec.tipo === 'warning' ? 'border-yellow-500/50 bg-yellow-500/10' : 
                    rec.tipo === 'success' ? 'border-green-500/50 bg-green-500/10' : 
                    'border-blue-500/50 bg-blue-500/10'
                }">
                    <div class="flex items-center space-x-4">
                        <div class="metric-icon p-2 rounded-xl">
                            <i data-lucide="${rec.icone}" class="w-5 h-5 ${
                                rec.tipo === 'danger' ? 'text-red-400' : 
                                rec.tipo === 'warning' ? 'text-yellow-400' : 
                                rec.tipo === 'success' ? 'text-green-400' : 
                                'text-blue-400'
                            }"></i>
                        </div>
                        <span class="font-semibold">${rec.texto}</span>
                    </div>
                </div>
            `).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // Configurar event listeners para filtros de data
        function configurarFiltrosData() {
            const startDateInput = document.getElementById('filter-date-start');
            const endDateInput = document.getElementById('filter-date-end');
            
            if (startDateInput) {
                startDateInput.addEventListener('change', function() {
                    console.log('Data inicial alterada:', this.value);
                    aplicarFiltros();
                    atualizarAnalises();
                });
            }
            
            if (endDateInput) {
                endDateInput.addEventListener('change', function() {
                    console.log('Data final alterada:', this.value);
                    aplicarFiltros();
                    atualizarAnalises();
                });
            }
        }

        // Função para carregar apostas
        async function carregarApostas() {
            showLoading();
            
            try {
                console.log('Tentando carregar apostas do Supabase...');
                
                if (!supabase) {
                    throw new Error('Supabase não inicializado');
                }

                let query = supabase.from('aposta').select('*').order('data', { ascending: true });

                const startDate = document.getElementById('filter-date-start')?.value;
                const endDate = document.getElementById('filter-date-end')?.value;
                
                if (startDate) {
                    query = query.gte('data', startDate);
                }
                if (endDate) {
                    query = query.lte('data', endDate);
                }

                const { data, error } = await query;
                
                if (error) {
                    console.error('Erro do Supabase:', error);
                    throw error;
                }

                console.log('Dados carregados:', data?.length || 0, 'apostas');
                apostas = data || [];
                
                aplicarFiltros();
                preencherFiltros();
                atualizarAnalises();
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                
                // Usar dados de exemplo
                criarDadosExemplo();
                aplicarFiltros();
                atualizarAnalises();
                
                mostrarMensagemOffline();
            } finally {
                hideLoading();
            }
        }

        function criarDadosExemplo() {
            const hoje = new Date();
            apostas = [];
            
            // Criar 20 apostas de exemplo
            for (let i = 0; i < 20; i++) {
                const data = new Date(hoje);
                data.setDate(data.getDate() - i);
                
                const resultado = Math.random() > 0.4 ? 'Ganhou' : 'Perdeu';
                const valorApostado = 50 + Math.random() * 100;
                const odd = 1.5 + Math.random() * 3;
                
                apostas.push({
                    id: i + 1,
                    data: data.toISOString().split('T')[0],
                    resultado: resultado,
                    valor_apostado: valorApostado.toFixed(2),
                    valor_final: resultado === 'Ganhou' ? (valorApostado * odd).toFixed(2) : '0',
                    odd_inicial: odd.toFixed(2),
                    odd_final: odd.toFixed(2),
                    casa_de_apostas: ['Bet365', 'Betano', 'Sportingbet'][Math.floor(Math.random() * 3)],
                    tipo_aposta: ['Simples', 'Múltipla'][Math.floor(Math.random() * 2)],
                    categoria: ['Futebol', 'Tênis', 'Basquete'][Math.floor(Math.random() * 3)]
                });
            }
            
            console.log('Dados de exemplo criados:', apostas.length, 'apostas');
        }

        function mostrarMensagemOffline() {
            const container = document.getElementById('insights-container');
            if (container) {
                container.innerHTML = `
                    <div class="insight-card p-6 rounded-2xl border-orange-500/50 bg-orange-500/10">
                        <div class="flex items-start space-x-4">
                            <div class="metric-icon p-2 rounded-xl">
                                <i data-lucide="wifi-off" class="w-5 h-5 text-orange-400"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-white mb-2">Modo Demonstração</h4>
                                <p class="text-slate-300">Usando dados de exemplo. Conecte-se ao banco para ver seus dados reais.</p>
                            </div>
                        </div>
                    </div>
                `;
                
                if (window.lucide) {
                    lucide.createIcons();
                }
            }
        }

        // Função auxiliar para verificar se uma aposta atende aos critérios de filtro
        function filtrarPorCriterios(aposta) {
            // Filtro por data
            if (!filtrarPorData(aposta)) return false;
            
            // Filtro por casa de apostas
            if (!filtrarPorCasa(aposta)) return false;
            
            // Filtro por tipo de aposta
            if (!filtrarPorTipo(aposta)) return false;
            
            // Filtro por categoria/torneio
            if (!filtrarPorCategoria(aposta)) return false;
            
            return true;
        }

        function filtrarPorData(aposta) {
            const dataAposta = new Date(aposta.data);
            const dataInicio = document.getElementById('filter-date-start')?.value;
            const dataFim = document.getElementById('filter-date-end')?.value;
            
            if (dataInicio && dataAposta < new Date(dataInicio)) return false;
            if (dataFim && dataAposta > new Date(dataFim)) return false;
            
            return true;
        }

        function filtrarPorCasa(aposta) {
            const casasSelecionadas = tomSelects.house?.getValue() || [];
            if (casasSelecionadas.length === 0) return true;
            
            return casasSelecionadas.includes(aposta.casa_de_apostas);
        }

        function filtrarPorTipo(aposta) {
            const tiposSelecionados = tomSelects.type?.getValue() || [];
            if (tiposSelecionados.length === 0) return true;
            
            return tiposSelecionados.includes(aposta.tipo_aposta);
        }

        function filtrarPorCategoria(aposta) {
            const categoriasSelecionadas = tomSelects.tournament?.getValue() || [];
            if (categoriasSelecionadas.length === 0) return true;
            
            const categoriasAposta = String(aposta.categoria || '').split(/[,;]+/).map(c => c.trim().toLowerCase());
            return categoriasSelecionadas.some(cat => 
                categoriasAposta.includes(cat.toLowerCase())
            );
        }

        function aplicarFiltros() {
            try {
                console.log('Aplicando filtros...');
                
                // Obter valores dos filtros de data
                const startDate = document.getElementById('filter-date-start')?.value;
                const endDate = document.getElementById('filter-date-end')?.value;
                
                // Obter valores dos filtros TomSelect
                const selectedHouses = tomSelects.house?.getValue() || [];
                const selectedTypes = tomSelects.type?.getValue() || [];
                const selectedTournaments = tomSelects.tournament?.getValue() || [];
                
                console.log('Filtros ativos:', {
                    dataInicio: startDate,
                    dataFim: endDate,
                    casas: selectedHouses,
                    tipos: selectedTypes,
                    torneios: selectedTournaments
                });
                
                // Aplicar filtros com lógica real
                apostasFiltradas = apostas.filter(aposta => {
                    return filtrarPorCriterios(aposta);
                });
                
                console.log(`Filtros aplicados: ${apostasFiltradas.length} apostas de ${apostas.length} total`);
            } catch (error) {
                console.error('Erro ao aplicar filtros:', error);
                apostasFiltradas = apostas;
            }
        }

        function preencherFiltros() {
            try {
                console.log('Preenchendo filtros...');
                const casas = [...new Set(apostas.map(a => a.casa_de_apostas).filter(Boolean))];
                const tipos = [...new Set(apostas.map(a => a.tipo_aposta).filter(Boolean))];

                // Normalizar categorias/torneios: separar por vírgula/; , aparar e remover duplicados case-insensitive
                const rawCategorias = apostas.map(a => a.categoria).filter(Boolean);
                const tokens = rawCategorias
                    .flatMap(c => String(c).split(/[,;]+/))
                    .map(s => s.trim())
                    .filter(Boolean);
                const lowerToOriginal = new Map();
                tokens.forEach(tok => {
                    const key = tok.toLowerCase();
                    if (!lowerToOriginal.has(key)) lowerToOriginal.set(key, tok);
                });
                const torneirosUnicos = Array.from(lowerToOriginal.values());

                // Helper robusto para (re)criar TomSelect
                function buildTomSelect(selector, values, placeholder) {
                    const el = document.querySelector(selector);
                    if (!el) return;
                    // destruir instância anterior com segurança
                    if (el.tomselect) {
                        try { el.tomselect.destroy(); } catch (e) { console.log('Erro destroy TomSelect', e); }
                    }
                    // limpar conteúdo original para evitar opções duplicadas
                    el.innerHTML = '';
                    // criar TomSelect com options injetadas
                    const tomSelect = new TomSelect(el, {
                        options: (values || []).map(v => ({ value: String(v), text: String(v) })),
                        items: [],
                        placeholder: placeholder || 'Selecione...',
                        plugins: ['remove_button'],
                        persist: false,
                        create: false,
                        maxItems: null,
                        allowEmptyOption: true,
                    });
                    
                    return tomSelect;
                }

                tomSelects.house = buildTomSelect('#filter-house', casas, 'Casas...');
                tomSelects.type = buildTomSelect('#filter-type', tipos, 'Tipos...');
                tomSelects.tournament = buildTomSelect('#filter-tournament', torneirosUnicos, 'Categorias/Torneios...');

                // Conectar eventos de filtragem automática
                if (tomSelects.house) {
                    tomSelects.house.on('change', () => { 
                        console.log('Filtro casa alterado');
                        aplicarFiltros(); 
                        atualizarAnalises(); 
                    });
                }
                if (tomSelects.type) {
                    tomSelects.type.on('change', () => { 
                        console.log('Filtro tipo alterado');
                        aplicarFiltros(); 
                        atualizarAnalises(); 
                    });
                }
                if (tomSelects.tournament) {
                    tomSelects.tournament.on('change', () => { 
                        console.log('Filtro categoria alterado');
                        aplicarFiltros(); 
                        atualizarAnalises(); 
                    });
                }

                console.log('Filtros preenchidos com sucesso');
            } catch (error) {
                console.error('Erro ao preencher filtros:', error);
            }
        }

        function atualizarAnalises() {
            atualizarMetricas();
            atualizarEstatisticas();
            criarGraficoSimples();
            criarGraficoDistribuicao();
            atualizarInsights();
        }

        function atualizarMetricas() {
            try {
                const totalApostado = apostasFiltradas.reduce((sum, aposta) => sum + (parseFloat(aposta.valor_apostado) || 0), 0);
                const lucro = calcularLucroTotal();
                const ganhas = apostasFiltradas.filter(a => a.resultado === 'Ganhou').length;
                const total = apostasFiltradas.length;
                const roi = calcularROI(lucro, totalApostado);
                const taxaAcerto = calcularTaxaAcerto(ganhas, total);

                // Atualizar elementos
                updateElementSafely('metric-total-apostado', formatarMoeda(totalApostado));
                updateElementSafely('metric-roi', formatarPercentual(roi));
                updateElementSafely('metric-lucro', formatarMoeda(lucro));
                updateElementSafely('metric-taxa-acerto', formatarPercentual(taxaAcerto));

                // Atualizar status
                const roiStatus = document.getElementById('metric-roi-status');
                if (roiStatus) {
                    if (roi >= 5) {
                        roiStatus.textContent = '✓ Excelente';
                        roiStatus.className = 'status-indicator status-excellent';
                    } else if (roi >= 0) {
                        roiStatus.textContent = '~ Positivo';
                        roiStatus.className = 'status-indicator status-good';
                    } else {
                        roiStatus.textContent = '✗ Negativo';
                        roiStatus.className = 'status-indicator status-poor';
                    }
                }

                const taxaStatus = document.getElementById('metric-taxa-status');
                if (taxaStatus) {
                    if (taxaAcerto >= 60) {
                        taxaStatus.textContent = '✓ Excelente';
                        taxaStatus.className = 'status-indicator status-excellent';
                    } else if (taxaAcerto >= 50) {
                        taxaStatus.textContent = '~ Bom';
                        taxaStatus.className = 'status-indicator status-good';
                    } else {
                        taxaStatus.textContent = '✗ Abaixo';
                        taxaStatus.className = 'status-indicator status-poor';
                    }
                }

                console.log('Métricas atualizadas:', { totalApostado, roi, lucro, taxaAcerto });
            } catch (error) {
                console.error('Erro ao atualizar métricas:', error);
            }
        }

        function calcularLucroTotal() {
            return apostasFiltradas
                .filter(aposta => aposta.resultado === 'Ganhou' || aposta.resultado === 'Perdeu' || aposta.resultado === 'Cashout')
                .reduce((sum, aposta) => {
                    const vf = parseFloat(aposta.valor_final) || 0;
                    return sum + vf;
                }, 0);
        }

        function calcularSequencias() {
            const apostasOrdenadas = [...apostasFiltradas].sort((a, b) => new Date(a.data) - new Date(b.data));
            
            let maiorVitorias = 0;
            let maiorDerrotas = 0;
            let sequenciaAtual = 0;
            let tipoAtual = null;
            
            let vitoriasAtual = 0;
            let derrotasAtual = 0;
            
            for (const aposta of apostasOrdenadas) {
                if (aposta.resultado === 'Ganhou' || aposta.resultado === 'Cashout') {
                    if (tipoAtual === 'vitoria') {
                        vitoriasAtual++;
                    } else {
                        maiorDerrotas = Math.max(maiorDerrotas, derrotasAtual);
                        vitoriasAtual = 1;
                        tipoAtual = 'vitoria';
                        derrotasAtual = 0;
                    }
                    maiorVitorias = Math.max(maiorVitorias, vitoriasAtual);
                } else if (aposta.resultado === 'Perdeu') {
                    if (tipoAtual === 'derrota') {
                        derrotasAtual++;
                    } else {
                        maiorVitorias = Math.max(maiorVitorias, vitoriasAtual);
                        derrotasAtual = 1;
                        tipoAtual = 'derrota';
                        vitoriasAtual = 0;
                    }
                    maiorDerrotas = Math.max(maiorDerrotas, derrotasAtual);
                }
            }
            
            // Sequência atual
            if (apostasOrdenadas.length > 0) {
                const ultimaAposta = apostasOrdenadas[apostasOrdenadas.length - 1];
                if (ultimaAposta.resultado === 'Ganhou' || ultimaAposta.resultado === 'Cashout') {
                    sequenciaAtual = vitoriasAtual;
                } else if (ultimaAposta.resultado === 'Perdeu') {
                    sequenciaAtual = -derrotasAtual;
                }
            }
            
            return { maiorVitorias, maiorDerrotas, sequenciaAtual };
        }

        function atualizarEstatisticas() {
            try {
                const totalApostas = apostasFiltradas.length;
                const diasUnicos = new Set(apostasFiltradas.map(a => a.data)).size;
                const apostasPorDia = totalApostas / (diasUnicos || 1);

                // Calcular odds de forma robusta
                const odds = apostasFiltradas.map(a => {
                    let odd = a.odd_final || a.odd_inicial || a.odd;
                    if (typeof odd === 'string') {
                        odd = odd.replace(',', '.');
                    }
                    return parseFloat(odd) || 0;
                }).filter(o => o > 0);
                
                const oddMedia = odds.length > 0 ? odds.reduce((a, b) => a + b, 0) / odds.length : 0;
                const oddAlta = odds.length > 0 ? Math.max(...odds) : 0;
                const oddBaixa = odds.length > 0 ? Math.min(...odds) : 0;

                // Calcular sequências
                const { maiorVitorias, maiorDerrotas, sequenciaAtual } = calcularSequencias();

                // Atualizar elementos
                updateElementSafely('stat-total-apostas', totalApostas);
                updateElementSafely('stat-apostas-dia', apostasPorDia.toFixed(1));
                updateElementSafely('stat-dias-ativos', diasUnicos);
                updateElementSafely('stat-odd-media', oddMedia.toFixed(2));
                updateElementSafely('stat-odd-alta', oddAlta.toFixed(2));
                updateElementSafely('stat-odd-baixa', oddBaixa.toFixed(2));
                updateElementSafely('stat-seq-vitorias', maiorVitorias);
                updateElementSafely('stat-seq-derrotas', maiorDerrotas);
                updateElementSafely('stat-seq-atual', sequenciaAtual > 0 ? `+${sequenciaAtual}` : sequenciaAtual.toString());

                console.log('Estatísticas atualizadas');
            } catch (error) {
                console.error('Erro ao atualizar estatísticas:', error);
            }
        }

        function atualizarInsights() {
            try {
                const container = document.getElementById('insights-container');
                if (!container) return;

                const totalApostado = apostasFiltradas.reduce((sum, aposta) => sum + (parseFloat(aposta.valor_apostado) || 0), 0);
                const lucro = calcularLucroTotal();
                const ganhas = apostasFiltradas.filter(a => a.resultado === 'Ganhou').length;
                const total = apostasFiltradas.length;
                const roi = calcularROI(lucro, totalApostado);
                const taxaAcerto = calcularTaxaAcerto(ganhas, total);
                const { maiorVitorias, maiorDerrotas, sequenciaAtual } = calcularSequencias();

                // Calcular odds média
                const odds = apostasFiltradas.map(a => {
                    let odd = a.odd_final || a.odd_inicial || a.odd;
                    if (typeof odd === 'string') odd = odd.replace(',', '.');
                    return parseFloat(odd) || 0;
                }).filter(o => o > 0);
                const oddMedia = odds.length > 0 ? odds.reduce((a, b) => a + b, 0) / odds.length : 0;

                const insights = [];

                // Insight 1: Performance Geral
                if (roi > 10) {
                    insights.push({
                        icon: 'trending-up',
                        color: 'emerald',
                        title: 'Excelente Performance!',
                        description: `Seu ROI de ${roi.toFixed(1)}% está muito acima da média. Continue com essa estratégia!`
                    });
                } else if (roi > 0) {
                    insights.push({
                        icon: 'thumbs-up',
                        color: 'green',
                        title: 'Performance Positiva',
                        description: `ROI de ${roi.toFixed(1)}% mostra que você está no caminho certo. Analise suas melhores apostas.`
                    });
                } else {
                    insights.push({
                        icon: 'alert-triangle',
                        color: 'red',
                        title: 'Atenção à Performance',
                        description: `ROI negativo de ${roi.toFixed(1)}%. Revise sua estratégia e considere reduzir o volume.`
                    });
                }

                // Insight 2: Taxa de Acerto
                if (taxaAcerto > 60) {
                    insights.push({
                        icon: 'target',
                        color: 'emerald',
                        title: 'Alta Precisão',
                        description: `Taxa de acerto de ${taxaAcerto.toFixed(1)}% é excelente! Sua análise está muito precisa.`
                    });
                } else if (taxaAcerto < 40) {
                    insights.push({
                        icon: 'crosshair',
                        color: 'orange',
                        title: 'Melhore a Precisão',
                        description: `Taxa de ${taxaAcerto.toFixed(1)}% está baixa. Foque em apostas com maior probabilidade.`
                    });
                }

                // Insight 3: Sequências
                if (sequenciaAtual > 3) {
                    insights.push({
                        icon: 'zap',
                        color: 'emerald',
                        title: 'Sequência Quente!',
                        description: `Você está em uma sequência de ${sequenciaAtual} vitórias! Aproveite o momento.`
                    });
                } else if (sequenciaAtual < -3) {
                    insights.push({
                        icon: 'pause',
                        color: 'red',
                        title: 'Sequência Fria',
                        description: `Sequência de ${Math.abs(sequenciaAtual)} derrotas. Considere uma pausa para reavaliar.`
                    });
                }

                // Insight 4: Odds
                if (oddMedia > 2.5) {
                    insights.push({
                        icon: 'dice-6',
                        color: 'blue',
                        title: 'Apostas de Alto Risco',
                        description: `Odd média de ${oddMedia.toFixed(2)} indica apostas arriscadas. Monitore o ROI cuidadosamente.`
                    });
                } else if (oddMedia < 1.5) {
                    insights.push({
                        icon: 'shield',
                        color: 'green',
                        title: 'Estratégia Conservadora',
                        description: `Odd média de ${oddMedia.toFixed(2)} mostra apostas seguras. Bom para capital preservação.`
                    });
                }

                // Insight 5: Volume
                if (total > 50) {
                    insights.push({
                        icon: 'bar-chart-3',
                        color: 'purple',
                        title: 'Alto Volume',
                        description: `${total} apostas mostram experiência. Analise padrões para otimizar ainda mais.`
                    });
                } else if (total < 10) {
                    insights.push({
                        icon: 'plus-circle',
                        color: 'blue',
                        title: 'Aumente o Volume',
                        description: `Apenas ${total} apostas. Mais dados ajudarão a identificar padrões de sucesso.`
                    });
                }

                // Renderizar insights
                if (insights.length === 0) {
                    container.innerHTML = `
                        <div class="insight-card p-6 rounded-2xl border-slate-500/50 bg-slate-500/10">
                            <div class="flex items-start space-x-4">
                                <div class="metric-icon p-2 rounded-xl">
                                    <i data-lucide="info" class="w-5 h-5 text-slate-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-white mb-2">Aguardando Dados</h4>
                                    <p class="text-slate-300">Adicione mais apostas para gerar insights personalizados.</p>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    container.innerHTML = insights.map(insight => `
                        <div class="insight-card p-6 rounded-2xl border-${insight.color}-500/50 bg-${insight.color}-500/10">
                            <div class="flex items-start space-x-4">
                                <div class="metric-icon p-2 rounded-xl">
                                    <i data-lucide="${insight.icon}" class="w-5 h-5 text-${insight.color}-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-white mb-2">${insight.title}</h4>
                                    <p class="text-slate-300">${insight.description}</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }

                // Recriar ícones Lucide
                if (window.lucide) {
                    lucide.createIcons();
                }

                console.log('Insights atualizados');
            } catch (error) {
                console.error('Erro ao atualizar insights:', error);
            }
        }

        function criarGraficoDistribuicao() {
            try {
                const canvas = document.getElementById('chart-distribuicao-resultados');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                
                // Verificar se Chart.js está disponível
                if (typeof Chart !== 'undefined') {
                    // Destruir gráfico anterior
                    if (charts.distribuicao) {
                        charts.distribuicao.destroy();
                    }

                    // Calcular dados de distribuição
                    const ganhas = apostasFiltradas.filter(a => a.resultado === 'Ganhou').length;
                    const perdidas = apostasFiltradas.filter(a => a.resultado === 'Perdeu').length;
                    const cashout = apostasFiltradas.filter(a => a.resultado === 'Cashout').length;
                    const pendentes = apostasFiltradas.filter(a => a.resultado === 'Pendente').length;

                    const dados = [
                        { label: 'Ganhas', value: ganhas, color: '#10b981' },
                        { label: 'Perdidas', value: perdidas, color: '#ef4444' },
                        { label: 'Cashout', value: cashout, color: '#f59e0b' },
                        { label: 'Pendentes', value: pendentes, color: '#6b7280' }
                    ].filter(item => item.value > 0);

                    // Se não há dados, mostrar mensagem
                    if (dados.length === 0) {
                        ctx.fillStyle = '#374151';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#9ca3af';
                        ctx.font = '16px Inter';
                        ctx.textAlign = 'center';
                        ctx.fillText('Nenhum dado disponível', canvas.width/2, canvas.height/2);
                        return;
                    }

                    charts.distribuicao = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: dados.map(item => item.label),
                            datasets: [{
                                data: dados.map(item => item.value),
                                backgroundColor: dados.map(item => item.color),
                                borderColor: dados.map(item => item.color),
                                borderWidth: 2,
                                hoverOffset: 10,
                                hoverBorderWidth: 3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '60%',
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: '#9ca3af',
                                        font: { size: 12, weight: 'bold' },
                                        padding: 20,
                                        usePointStyle: true,
                                        pointStyle: 'circle'
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleColor: '#ffffff',
                                    bodyColor: '#ffffff',
                                    borderColor: '#374151',
                                    borderWidth: 1,
                                    cornerRadius: 8,
                                    displayColors: true,
                                    callbacks: {
                                        title: function(context) {
                                            return context[0].label;
                                        },
                                        label: function(context) {
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                                            return `${context.parsed} apostas (${percentage}%)`;
                                        }
                                    }
                                }
                            },
                            animation: {
                                animateRotate: true,
                                animateScale: true,
                                duration: 1000,
                                easing: 'easeOutQuart'
                            },
                            interaction: {
                                intersect: false
                            }
                        }
                    });
                } else {
                    // Fallback: criar gráfico simples com canvas
                    ctx.fillStyle = '#374151';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#9ca3af';
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText('Chart.js não disponível', canvas.width/2, canvas.height/2);
                }
            } catch (error) {
                console.error('Erro ao criar gráfico de distribuição:', error);
            }
        }

        function criarGraficoSimples() {
            try {
                const canvas = document.getElementById('chart-evolucao-lucro');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                
                // Verificar se Chart.js está disponível
                if (typeof Chart !== 'undefined') {
                    // Destruir gráfico anterior
                    if (charts.evolucao) {
                        charts.evolucao.destroy();
                    }

                    // Preparar dados - ordenar por data e calcular saldo acumulado
                    const apostasOrdenadas = [...apostasFiltradas].sort((a, b) => new Date(a.data) - new Date(b.data));
                    let saldo = 0;
                    const dados = apostasOrdenadas.map((aposta) => {
                        if (aposta.resultado === 'Ganhou' || aposta.resultado === 'Perdeu' || aposta.resultado === 'Cashout') {
                            saldo += (parseFloat(aposta.valor_final) || 0);
                        }
                        return {
                            x: new Date(aposta.data).getTime(),
                            y: saldo
                        };
                    });

                    // Se não há dados, mostrar mensagem
                    if (dados.length === 0) {
                        ctx.fillStyle = '#374151';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#9ca3af';
                        ctx.font = '16px Inter';
                        ctx.textAlign = 'center';
                        ctx.fillText('Nenhum dado disponível', canvas.width/2, canvas.height/2);
                        return;
                    }

                    charts.evolucao = new Chart(ctx, {
                        type: 'line',
                        data: {
                            datasets: [{
                                label: 'Lucro Acumulado',
                                data: dados,
                                borderColor: '#6366f1',
                                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 3,
                                pointBackgroundColor: '#6366f1',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 3,
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointHoverBackgroundColor: '#4f46e5',
                                pointHoverBorderColor: '#ffffff',
                                pointHoverBorderWidth: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            plugins: {
                                legend: { 
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        color: '#9ca3af',
                                        font: { size: 14, weight: 'bold' },
                                        usePointStyle: true,
                                        pointStyle: 'line'
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                    titleColor: '#ffffff',
                                    bodyColor: '#ffffff',
                                    borderColor: '#6366f1',
                                    borderWidth: 2,
                                    cornerRadius: 12,
                                    displayColors: true,
                                    padding: 12,
                                    titleFont: { size: 14, weight: 'bold' },
                                    bodyFont: { size: 13 },
                                    callbacks: {
                                        title: function(context) {
                                            const data = new Date(context[0].parsed.x);
                                            return `📅 ${data.toLocaleDateString('pt-BR')}`;
                                        },
                                        label: function(context) {
                                            return `💰 Lucro Acumulado: ${formatarMoeda(context.parsed.y)}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: { 
                                    type: 'time',
                                    time: {
                                        unit: 'day',
                                        displayFormats: {
                                            day: 'dd/MM'
                                        }
                                    },
                                    title: { 
                                        display: true, 
                                        text: '📅 Data',
                                        color: '#9ca3af',
                                        font: { size: 14, weight: 'bold' }
                                    },
                                    grid: { 
                                        color: 'rgba(148, 163, 184, 0.2)',
                                        drawBorder: false,
                                        lineWidth: 1
                                    },
                                    ticks: {
                                        color: '#6b7280',
                                        font: { size: 12, weight: '500' },
                                        maxTicksLimit: 6,
                                        padding: 8
                                    }
                                },
                                y: { 
                                    title: { 
                                        display: true, 
                                        text: '💰 Lucro Acumulado (R$)',
                                        color: '#9ca3af',
                                        font: { size: 14, weight: 'bold' }
                                    },
                                    grid: { 
                                        color: 'rgba(148, 163, 184, 0.2)',
                                        drawBorder: false,
                                        lineWidth: 1
                                    },
                                    ticks: {
                                        color: '#6b7280',
                                        font: { size: 12, weight: '500' },
                                        padding: 8,
                                        callback: function(value) {
                                            return formatarMoeda(value);
                                        }
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // Fallback: criar gráfico simples com canvas
                    ctx.fillStyle = '#374151';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#9ca3af';
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText('Chart.js não disponível', canvas.width/2, canvas.height/2);
                }
            } catch (error) {
                console.error('Erro ao criar gráfico:', error);
            }
        }

        // Configurar botão de limpar filtros
        function configurarBotaoLimparFiltros() {
            const btnClearFilters = document.getElementById('btn-clear-filters');
            if (btnClearFilters) {
                btnClearFilters.addEventListener('click', function() {
                    // Limpar datas
                    const startDateInput = document.getElementById('filter-date-start');
                    const endDateInput = document.getElementById('filter-date-end');
                    
                    if (startDateInput) startDateInput.value = '';
                    if (endDateInput) endDateInput.value = '';
                    
                    // Limpar TomSelects
                    if (tomSelects.house) tomSelects.house.clear();
                    if (tomSelects.type) tomSelects.type.clear();
                    if (tomSelects.tournament) tomSelects.tournament.clear();
                    
                    // Reaplicar filtros
                    aplicarFiltros();
                    atualizarAnalises();
                    
                    console.log('Filtros limpos');
                });
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            try {
                console.log('Inicializando BetTracker Dashboard...');
                
                // Inicializar Lucide Icons
                if (window.lucide) {
                    lucide.createIcons();
                }

                // Inicializar Supabase
                try {
                    if (window.supabase) {
                        supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
                        console.log('Supabase inicializado');
                    } else {
                        console.warn('Supabase não disponível');
                    }
                } catch (error) {
                    console.error('Erro ao inicializar Supabase:', error);
                }
                
                // Configurar sistema de abas
                configurarAbas();
                
                // Definir data padrão
                const hoje = new Date().toISOString().split('T')[0];
                const endDateInput = document.getElementById('filter-date-end');
                if (endDateInput) {
                    endDateInput.value = hoje;
                }
                
                // Configurar event listeners
                const refreshBtn = document.getElementById('refresh-data');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', carregarApostas);
                }
                
                // Configurar event listeners para filtros de data
                configurarFiltrosData();
                
                // Configurar botão limpar filtros
                configurarBotaoLimparFiltros();
                
                // Carregar dados
                carregarApostas();
                
                console.log('Dashboard inicializado com sucesso!');
            } catch (error) {
                console.error('Erro na inicialização:', error);
            }
        });
    </script>
</body>
</html>